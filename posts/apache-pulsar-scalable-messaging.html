<!DOCTYPE html>
<html>

<head>
    <title>Building Scalable Message Systems with Apache Pulsar - Brandon Hoffman</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&family=Russo+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../themes/default.css">
    <link id="theme-style" rel="stylesheet" type="text/css" href="">
</head>

<body>
    <section class="s1">
        <div class="main-container">
            <div class="intro-wrapper">
                <div class="nav-wrapper">
                    <div class="dots-wrapper">
                        <div id="dot1" class="browser-dot"></div>
                        <div id="dot2" class="browser-dot"></div>
                        <div id="dot3" class="browser-dot"></div>
                    </div>

                    <ul id="navigation">
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="../blog.html">Blog</a></li>
                        <li><a href="../index.html#contact">Contact</a></li>
                    </ul>
                </div>

                <div class="left-column">
                    <h5 style="text-align: center; line-height: 0;">Personalize Your Theme</h5>
                    <div id="theme-options-wrapper">
                        <div data-mode="light" data-text="Default" data-icon="../images/Switch_icon.svg" id="light-mode" class="theme-dot"></div>
                        <div data-mode="nes" data-text="NES" data-icon="../images/NES_icon.svg" id="nes-mode" class="theme-dot"></div>
                        <div data-mode="snes" data-text="SNES" data-icon="../images/SNES_icon.svg" id="snes-mode" class="theme-dot"></div>
                        <div data-mode="n64" data-text="N64" data-icon="../images/N64_icon.svg" id="n64-mode" class="theme-dot"></div>
                    </div>
                    <div id="theme-text"></div>
                    <img id="theme-icon" src="../images/Switch_icon.svg">
                    <p id="settings-note">*Your theme settings will be remembered for your next visit.</p>
                </div>

                <div class="right-column">
                    <div id="preview-shadow">
                        <div id="preview">
                            <div id="corner-tl" class="corner"></div>
                            <div id="corner-tr" class="corner"></div>
                            <h3>Blog Post</h3>
                            <p>Deep dive into technical insights and lessons learned from real-world implementation.</p>
                            <div id="corner-br" class="corner"></div>
                            <div id="corner-bl" class="corner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="s2">
        <div class="main-container">
            <article class="blog-post-full">
                <header class="post-header">
                    <h1>Building Scalable Message Systems with Apache Pulsar</h1>
                    <div class="post-meta">
                        <time datetime="2025-01-15">January 15, 2025</time>
                        <span class="tags">DevOps, Apache Pulsar, Distributed Systems</span>
                    </div>
                </header>

                <div class="post-content">
                    <p>In my current role at The Climate Corp, I've been working extensively with Apache Pulsar to build robust message brokering systems. Here are some key insights I've gathered about implementing scalable messaging architectures in production environments.</p>

                    <h2>Why Apache Pulsar?</h2>
                    
                    <p>When we evaluated messaging solutions for our distributed systems, Apache Pulsar stood out for several key reasons:</p>

                    <ul>
                        <li><strong>Multi-tenancy by Design:</strong> Unlike many messaging systems, Pulsar was built from the ground up with multi-tenancy in mind. This allows us to logically separate different services and teams while sharing the same infrastructure.</li>
                        <li><strong>Geo-replication:</strong> Built-in support for cross-datacenter replication was crucial for our disaster recovery strategy.</li>
                        <li><strong>Tiered Storage:</strong> The ability to automatically move older messages to cheaper storage (like AWS S3) helps us manage costs while maintaining message durability.</li>
                    </ul>

                    <h2>Architecture Considerations</h2>

                    <p>Our Pulsar deployment consists of several key components that work together to provide a highly available messaging platform:</p>

                    <h3>Broker Layer</h3>
                    <p>We run multiple Pulsar brokers in different availability zones. The stateless nature of Pulsar brokers makes scaling straightforward - we can add or remove brokers based on traffic patterns without complex data rebalancing.</p>

                    <h3>BookKeeper Storage</h3>
                    <p>BookKeeper provides the durable storage layer for Pulsar. We've learned that proper tuning of BookKeeper is critical for performance. Key configurations include:</p>

                    <ul>
                        <li>Setting appropriate journal and ledger directory configurations</li>
                        <li>Tuning the write and read thread pools based on workload</li>
                        <li>Configuring proper disk I/O settings for your storage type</li>
                    </ul>

                    <h2>Operational Lessons</h2>

                    <h3>Monitoring and Observability</h3>
                    <p>Effective monitoring is crucial for any distributed system. For Pulsar, we focus on several key metrics:</p>

                    <ul>
                        <li><strong>Throughput metrics:</strong> Messages in/out per second, bytes in/out</li>
                        <li><strong>Latency metrics:</strong> End-to-end message latency, storage latency</li>
                        <li><strong>Resource utilization:</strong> CPU, memory, and disk usage across all components</li>
                        <li><strong>Consumer lag:</strong> How far behind consumers are from the latest messages</li>
                    </ul>

                    <h3>Capacity Planning</h3>
                    <p>One of the biggest challenges we faced was understanding how to properly size our Pulsar deployment. Through experience, we've developed these guidelines:</p>

                    <p>Start with your message throughput requirements, but don't forget to account for:</p>
                    <ul>
                        <li>Message retention requirements (how long do you need to keep messages?)</li>
                        <li>Peak traffic patterns (not just average throughput)</li>
                        <li>Consumer patterns (do you have slow consumers that might cause backlog?)</li>
                        <li>Replication overhead (geo-replication can significantly impact bandwidth)</li>
                    </ul>

                    <h2>Integration with Kubernetes</h2>

                    <p>Running Pulsar on Kubernetes presents both opportunities and challenges. We use the official Pulsar Helm charts as a starting point, but have made several customizations:</p>

                    <h3>Storage Considerations</h3>
                    <p>BookKeeper requires persistent storage with good I/O performance. We use:</p>
                    <ul>
                        <li>SSD-backed persistent volumes for BookKeeper journal and ledger storage</li>
                        <li>Separate storage classes for different performance requirements</li>
                        <li>Proper resource requests and limits to ensure consistent performance</li>
                    </ul>

                    <h3>Networking</h3>
                    <p>Pulsar's architecture requires careful consideration of networking:</p>
                    <ul>
                        <li>Brokers need to be accessible by both producers and consumers</li>
                        <li>BookKeeper nodes need low-latency communication between each other</li>
                        <li>ZooKeeper requires stable network connections for consensus</li>
                    </ul>

                    <h2>Performance Optimization</h2>

                    <p>Through our production experience, we've identified several key areas for optimization:</p>

                    <h3>Producer Configuration</h3>
                    <p>For high-throughput scenarios, batching is crucial. We typically configure:</p>
                    <ul>
                        <li>Batch size limits based on message size and latency requirements</li>
                        <li>Compression algorithms (LZ4 works well for most use cases)</li>
                        <li>Appropriate timeout values to balance latency and throughput</li>
                    </ul>

                    <h3>Consumer Optimization</h3>
                    <p>Consumer performance can often be the bottleneck. Key optimizations include:</p>
                    <ul>
                        <li>Proper receive queue sizing to balance memory usage and throughput</li>
                        <li>Batch acknowledgment strategies to reduce overhead</li>
                        <li>Parallel processing where message ordering isn't critical</li>
                    </ul>

                    <h2>Looking Forward</h2>

                    <p>Apache Pulsar continues to evolve rapidly. Some exciting developments we're tracking:</p>

                    <ul>
                        <li><strong>Pulsar Functions:</strong> Serverless computing framework built on top of Pulsar</li>
                        <li><strong>Protocol Handlers:</strong> Support for Kafka protocol and others</li>
                        <li><strong>Enhanced Security:</strong> Improved authentication and authorization capabilities</li>
                    </ul>

                    <p>Building scalable messaging systems requires careful consideration of both technical and operational factors. Apache Pulsar provides a solid foundation, but success depends on proper architecture, configuration, and operational practices. The investment in learning and implementing Pulsar has paid dividends in our ability to handle complex, high-scale messaging requirements.</p>

                    <div class="post-footer">
                        <p><em>Have questions about Apache Pulsar or messaging architecture? <a href="../index.html#contact">Get in touch</a> - I'd love to discuss your use case.</em></p>
                    </div>
                </div>
            </article>
        </div>
    </section>

    <script type="text/javascript" src="../scripts/setThemeForGivenDotClick.js"></script>
    <script type="text/javascript" src="../scripts/setHoverOnDotEffects.js"></script>
</body>

</html>